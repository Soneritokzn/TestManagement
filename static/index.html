<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"></link>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 font-roboto">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-4">Test Management System</h1>
        
        <div class="bg-white p-6 rounded-lg shadow-lg mb-6">
            <h2 class="text-2xl font-semibold mb-4">Create Test Case</h2>
            <form id="test-case-form">
                <div class="mb-4">
                    <label for="name" class="block text-gray-700 font-medium mb-2">Name</label>
                    <input type="text" id="name" class="w-full p-2 border border-gray-300 rounded-lg" required>
                </div>
                <div class="mb-4">
                    <label for="description" class="block text-gray-700 font-medium mb-2">Description</label>
                    <textarea id="description" class="w-full p-2 border border-gray-300 rounded-lg" rows="3" required></textarea>
                </div>
                <div class="mb-4">
                    <label for="pre-conditions" class="block text-gray-700 font-medium mb-2">Pre-Conditions</label>
                    <textarea id="pre-conditions" class="w-full p-2 border border-gray-300 rounded-lg" rows="3" required></textarea>
                </div>
                <div class="mb-4">
                    <label for="post-conditions" class="block text-gray-700 font-medium mb-2">Post-Conditions</label>
                    <textarea id="post-conditions" class="w-full p-2 border border-gray-300 rounded-lg" rows="3" required></textarea>
                </div>
                <button type="button" id="confirm-test-case" class="bg-blue-500 text-white px-4 py-2 rounded-lg">Confirm</button>
            </form>
        </div>

        <div id="steps-section" class="hidden bg-white p-6 rounded-lg shadow-lg mb-6">
            <h2 class="text-2xl font-semibold mb-4">Add Steps</h2>
            <form id="steps-form">
                <div class="mb-4">
                    <label for="step" class="block text-gray-700 font-medium mb-2">Step</label>
                    <input type="text" id="step" class="w-full p-2 border border-gray-300 rounded-lg" required>
                </div>
                <div class="mb-4">
                    <label for="expected-result" class="block text-gray-700 font-medium mb-2">Expected Result</label>
                    <input type="text" id="expected-result" class="w-full p-2 border border-gray-300 rounded-lg" required>
                </div>
                <div class="mb-4">
                    <label for="fact-result" class="block text-gray-700 font-medium mb-2">Fact Result</label>
                    <input type="text" id="fact-result" class="w-full p-2 border border-gray-300 rounded-lg" required>
                </div>
                <button type="button" id="add-step" class="bg-green-500 text-white px-4 py-2 rounded-lg">Add Step</button>
            </form>
            <table class="w-full mt-4 border-collapse">
                <thead>
                    <tr>
                        <th class="border p-2">Step</th>
                        <th class="border p-2">Expected Result</th>
                        <th class="border p-2">Fact Result</th>
                    </tr>
                </thead>
                <tbody id="steps-table-body">
                    <!-- Steps will be added here -->
                </tbody>
            </table>
            <button type="button" id="save-test-case" class="bg-blue-500 text-white px-4 py-2 rounded-lg mt-4">Save Test Case</button>
        </div>

        <div id="test-cases-section" class="bg-white p-6 rounded-lg shadow-lg">
            <h2 class="text-2xl font-semibold mb-4">Saved Test Cases</h2>
            <table class="w-full border-collapse">
                <thead>
                    <tr>
                        <th class="border p-2">Name</th>
                        <th class="border p-2">Description</th>
                        <th class="border p-2">Actions</th>
                    </tr>
                </thead>
                <tbody id="test-cases-table-body">
                    <!-- Test cases will be added here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const apiUrl = 'http://localhost:5000/api/testCases';

        document.getElementById('confirm-test-case').addEventListener('click', function() {
            document.getElementById('steps-section').classList.remove('hidden');
        });

        document.getElementById('add-step').addEventListener('click', function() {
            const step = document.getElementById('step').value;
            const expectedResult = document.getElementById('expected-result').value;
            const factResult = document.getElementById('fact-result').value;

            const tableBody = document.getElementById('steps-table-body');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="border p-2">${step}</td>
                <td class="border p-2">${expectedResult}</td>
                <td class="border p-2">${factResult}</td>
            `;
            tableBody.appendChild(row);

            document.getElementById('steps-form').reset();
        });

        document.getElementById('save-test-case').addEventListener('click', async function() {
            const name = document.getElementById('name').value;
            const description = document.getElementById('description').value;
            const preConditions = document.getElementById('pre-conditions').value;
            const postConditions = document.getElementById('post-conditions').value;

            const steps = [];
            document.querySelectorAll('#steps-table-body tr').forEach(row => {
                const step = row.children[0].innerText;
                const expectedResult = row.children[1].innerText;
                const factResult = row.children[2].innerText;
                steps.push({ step, expectedResult, factResult });
            });

            const testCase = { name, description, preConditions, postConditions, steps };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(testCase)
            });

            if (response.ok) {
                loadTestCases();
                document.getElementById('test-case-form').reset();
                document.getElementById('steps-form').reset();
                document.getElementById('steps-table-body').innerHTML = '';
                document.getElementById('steps-section').classList.add('hidden');
            }
        });

        async function loadTestCases() {
            const response = await fetch(apiUrl);
            const testCases = await response.json();

            const tableBody = document.getElementById('test-cases-table-body');
            tableBody.innerHTML = '';
            testCases.forEach(testCase => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border p-2">${testCase.name}</td>
                    <td class="border p-2">${testCase.description}</td>
                    <td class="border p-2">
                        <button class="bg-red-500 text-white px-2 py-1 rounded-lg mr-2" onclick="deleteTestCase('${testCase._id}')">Delete</button>
                        <button class="bg-yellow-500 text-white px-2 py-1 rounded-lg" onclick="exportTestCase('${testCase._id}')">Export to DOC</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        async function deleteTestCase(id) {
            const response = await fetch(`${apiUrl}/${id}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                loadTestCases();
            }
        }

        async function exportTestCase(id) {
            const response = await fetch(`${apiUrl}/export/${id}`);
            const testCase = await response.json();

            // Logic to export to DOC file
            // For simplicity, we will just log the test case
            console.log(testCase);
        }
        async function exportTestCase(id) {
    const response = await fetch(`${apiUrl}/export/${id}`);
    if (response.ok) {
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "test_case.docx";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    } else {
        alert("Export failed!");
    }
}

        // Load test cases on page load
        loadTestCases();
    </script>
</body>
</html>